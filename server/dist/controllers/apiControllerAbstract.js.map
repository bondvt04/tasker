{"version":3,"sources":["controllers/apiControllerAbstract.js"],"names":[],"mappings":";;;;;;;;;;AAIA,IAAI,MAAM,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;AAC/B,IAAI,MAAM,GAAG,OAAO,CAAC,qBAAqB,CAAC,CAAC;;IAEtC,qBAAqB;;;;;;;;;;AASZ,aATT,qBAAqB,GAST;8BATZ,qBAAqB;KAWtB;;iBAXC,qBAAqB;;;;eAaT,wBAAC,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE;AAC3B,kBAAM,CAAC,GAAG,CAAC,4BAA4B,CAAC,CAAC;AACzC,mBAAO,IAAI,OAAO,CAAC,UAAS,OAAO,EAAE,MAAM,EAAE;AACzC,sBAAM,CAAC,GAAG,CAAC,4BAA4B,CAAC,CAAC;AACzC,uBAAO,EAAE,CAAC;aACb,CAAC,CAAC;;;;SAIN;;;;;;;eAKY,uBAAC,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE,YAAY,EAAE;AACxC,kBAAM,CAAC,GAAG,CAAC,2BAA2B,CAAC,CAAC;AACxC,mBAAO,IAAI,OAAO,CAAC,UAAS,OAAO,EAAE,MAAM,EAAE;AACzC,sBAAM,CAAC,GAAG,CAAC,2BAA2B,CAAC,CAAC;AACxC,4BAAY,CAAC,CAAC,GAAG,MAAM,CAAC;AACxB,uBAAO,CAAC,YAAY,CAAC,CAAC;AACtB,mBAAG,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;;;AAGvB,oBAAI,EAAE,CAAC;aACV,CAAC,CAAC;SACN;;;;;;;;;;;eASO,kBAAC,UAAU,EAAE,IAAI,EAAE;AACvB,gBAAI,IAAI,GAAG,IAAI,CAAC;;AAEhB,gBAAI,YAAY,GAAG,GAAG,GAAC,UAAU,GAAC,QAAQ,CAAA;AAC1C,gBAAI,GAAG,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;AAClB,gBAAI,GAAG,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;AAClB,gBAAI,IAAI,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;;AAEnB,qBAAS,UAAU,CAAC,GAAG,EAAE;AACrB,sBAAM,CAAC,KAAK,CAAC,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;AAC9B,sBAAM,CAAC,KAAK,CAAC,cAAc,EAAE,GAAG,CAAC,KAAK,CAAC,CAAC;AACxC,oBAAI,CAAC,GAAG,CAAC,CAAC;aACb;;AAED,mBAAO,IAAI,OAAO,CAAC,UAAS,OAAO,EAAE,MAAM,EAAE;AACzC,oBAAI,CAAC,cAAc,EAAE,CAAC,IAAI,CAAC,UAAS,kBAAkB,EAAE;;AAEpD,wBAAI,CAAC,YAAY,CAAC,CAAC,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE,kBAAkB,CAAC,CAAC,IAAI,CAAC,UAAS,YAAY,EAAE;AAC/E,4BAAI,CAAC,aAAa,CAAC,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE,YAAY,CAAC,CAAC,IAAI,CAAC,UAAS,iBAAiB,EAAE;AAC9E,mCAAO,CAAC,iBAAiB,CAAC,CAAC;yBAC9B,CAAC,SAAM,CAAC,UAAU,CAAC,CAAC;qBACxB,CAAC,SAAM,CAAC,UAAU,CAAC,CAAC;iBACxB,CAAC,SAAM,CAAC,UAAU,CAAC,CAAC;aACxB,CAAC,CAAC;SACN;;;WAvEC,qBAAqB;;;AA0E3B,MAAM,CAAC,OAAO,GAAG,qBAAqB,CAAC","file":"controllers/apiControllerAbstract.js","sourcesContent":["/**\n * Created by anatoliybondar on 9/14/15.\n */\n\nvar colors = require('colors');\nvar logger = require(\"verbose-console-log\");\n\nclass ApiControllerAbstract {\n\n    /**\n     * @todo add \"isAbstract\" like this:\n     *\n     * if (new.target === ApiControllerAbstract) {\n     *     throw new TypeError(\"Cannot construct Abstract instances directly\");\n     * }\n     */\n    constructor() {\n        //logger.log(\"ApiControllerAbstract.constructor\");\n    }\n\n    __beforeAction(req, res, next) {\n        logger.log(\"Controller.__beforeAction1\");\n        return new Promise(function(resolve, reject) {\n            logger.log(\"Controller.__beforeAction2\");\n            resolve();\n        });\n\n        // we will render it later if no error\n        //res.jsonToRender = {};\n    }\n\n    /**\n     * @param actionResult - result from \"action\" promise\n     */\n    __afterAction(req, res, next, actionResult) {\n        logger.log(\"Controller.__afterAction1\");\n        return new Promise(function(resolve, reject) {\n            logger.log(\"Controller.__afterAction2\");\n            actionResult.c = \"csdf\";\n            resolve(actionResult);\n            res.send(actionResult);\n            //res.send(\"asdf\");\n            //res.send(\"qwer\");\n            next();\n        });\n    }\n\n    /**\n     * __beforeActionPromise -> actionPromise -> __afterActionPromise\n     *\n     * Args: [req, res, next]\n     *\n     * Old implementation: var actionPromise = self[functionName](...Array.prototype.slice.call(args))\n     */\n    doAction(actionName, args) {\n        var self = this;\n\n        var functionName = \"_\"+actionName+\"Action\"\n        var req = args[0];\n        var res = args[1];\n        var next = args[2];\n\n        function catchError(err) {\n            logger.error(err.message.red);\n            logger.error(\"Error stack:\", err.stack);\n            next(err);\n        }\n\n        return new Promise(function(resolve, reject) {\n            self.__beforeAction().then(function(beforeActionResult) {\n                // action must not know about \"beforeActionResult\" - only about \"args\"\n                self[functionName](req, res, next, beforeActionResult).then(function(actionResult) {\n                    self.__afterAction(req, res, next, actionResult).then(function(afterActionResult) {\n                        resolve(afterActionResult);\n                    }).catch(catchError);\n                }).catch(catchError);\n            }).catch(catchError);\n        });\n    }\n}\n\nmodule.exports = ApiControllerAbstract;"],"sourceRoot":"/source/"}